
---

## **ะคะะะ 2: firmware/common/mesh_protocol.h**

```c
/**
ย* ๐ฏ MeshStatic-Hybrid: ะฏะดัะพ ะฟัะพัะพะบะพะปะฐ ัะฒัะทะธ
ย*ย
ย* ะะกะฏ ัะฒัะทั ะผะตะถะดั ััััะพะนััะฒะฐะผะธ ะธะดัั ัะตัะตะท ััะพั ะฟัะพัะพะบะพะป.
ย* ะะฐะถะดัะน ะฟะฐะบะตั ะธะผะตะตั ะทะฐะณะพะปะพะฒะพะบ ะธ ะฟะพะปะตะทะฝัั ะฝะฐะณััะทะบั.
ย*ย
ย* ๐ฆ ะกัััะบัััะฐ ะฟะฐะบะตัะฐ (250 ะฑะฐะนั ะผะฐะบัะธะผัะผ):
ย* โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
ย* โ ย ะะฐะณะพะปะพะฒะพะบย ย โ ย ะะพะปะตะทะฝะฐั ย โ
ย* โ ย (40 ะฑะฐะนั)ย ย โย ะฝะฐะณััะทะบะฐย ย โ
ย* โย ย ย ย ย ย ย ย โย (210 ะฑะฐะนั)ย โ
ย* โโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ
ย*/

#pragma once
#include <stdint.h>
#include <stdbool.h>

// ๐ ะะดะตะฝัะธัะธะบะฐัะพั ะฝะฐัะตะน ัะตัะธ
// ะัะปะธ ััััะพะนััะฒะพ ะฒะธะดะธั ะดััะณะพะน network_id โ ะธะณะฝะพัะธััะตั ะฟะฐะบะตั
#define MESH_NETWORK_ID ย ย ย ย 0xFA23ย ย ย // FA23 = "Mesh" ะฒ hex-speak
#define PROTOCOL_VERSIONย ย ย ย 0x01ย ย ย ย // ะะตััะธั ะฟัะพัะพะบะพะปะฐ
#define MAX_PACKET_SIZE ย ย ย ย 250 ย ย ย ย // ะะฐะบั ัะฐะทะผะตั ESP-NOW ะฟะฐะบะตัะฐ
#define DEFAULT_TTL ย ย ย ย ย ย 7 ย ย ย ย ย // Time-To-Live (ะผะฐะบั 7 ะฟััะถะบะพะฒ)

// ๐ก MAC ะฐะดัะตั ะดะปั ัะธัะพะบะพะฒะตัะฐะฝะธั (ะฒัะตะผ ััััะพะนััะฒะฐะผ)
static const uint8_t BROADCAST_MAC[6] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

/**
ย* ๐๏ธ ะขะธะฟั ัะพะพะฑัะตะฝะธะน
ย*ย
ย* ะะฐะถะดัะน ะฟะฐะบะตั ะธะผะตะตั ัะธะฟ, ะบะพัะพััะน ะพะฟัะตะดะตะปัะตั ะบะฐะบ ะตะณะพ ะพะฑัะฐะฑะฐััะฒะฐัั.
ย* ะัะธะพัะธัะตั ะพะฑัะฐะฑะพัะบะธ: EMERGENCY > HEARTBEAT > CMD > DATA
ย*/
typedef enum {
ยยยย// ๐ ะะฐะฝะฝัะต (ะฝะธะทะบะธะน ะฟัะธะพัะธัะตั)
ยยยยMSG_DATA_SENSORย ย ย ย = 0x01,ย // ะะฐะฝะฝัะต ั ะดะฐััะธะบะพะฒ (ัะตะผะฟะตัะฐัััะฐ ะธ ั.ะด.)
ยยยยMSG_DATA_ACTUATORย ย ย = 0x02,ย // ะกะพััะพัะฝะธะต ะธัะฟะพะปะฝะธัะตะปั (ะฒะบะป/ะฒัะบะป)
ยยยย
ยยยย// ๐ฎ ะะพะผะฐะฝะดั (ััะตะดะฝะธะน ะฟัะธะพัะธัะตั)ยย
ยยยยMSG_CMD_SETย ย ย ย ย ย = 0x03,ย // ะะพะผะฐะฝะดะฐ "ัะดะตะปะฐะน ััะพ-ัะพ"
ยยยยMSG_CMD_GETย ย ย ย ย ย = 0x04,ย // ะะฐะฟัะพั "ัะบะฐะถะธ ััะฐััั"
ยยยยMSG_CMD_GROUPย ย ย ย ย = 0x08,ย // ะะพะผะฐะฝะดะฐ ะดะปั ะณััะฟะฟั ััััะพะนััะฒ
ยยยย
ยยยย// ๐จ ะญะบัััะตะฝะฝัะต ัะพะฑััะธั (ะฒัััะธะน ะฟัะธะพัะธัะตั)
ยยยยMSG_EVENT_BROADCASTย ย = 0x09,ย // ะจะธัะพะบะพะฒะตัะฐัะตะปัะฝะพะต ัะพะฑััะธะต (ะฟะพะถะฐั, ะฟัะพัะตัะบะฐ)
ยยยย
ยยยย// ๐ ะกะปัะถะตะฑะฝัะต (ะฒััะพะบะธะน ะฟัะธะพัะธัะตั)
ยยยยMSG_HEARTBEATย ย ย ย ย = 0x06,ย "ะัะปัั" ััััะพะนััะฒะฐ ("ั ะถะธะฒะพะน")
ยยยยMSG_DISCOVERYย ย ย ย ย = 0x07,ย // "ะฏ ะฝะพะฒะตะฝัะบะธะน, ะฟัะธะผะธัะต ะฒ ัะตัั"
} MessageType;

/**
ย* ๐ฉ ะคะปะฐะณะธ ะฟะฐะบะตัะฐ
ย*ย
ย* ะคะปะฐะณะธ ะผะตะฝััั ะฟะพะฒะตะดะตะฝะธะต ะพะฑัะฐะฑะพัะบะธ ะฟะฐะบะตัะฐ.
ย* ะะฐะฟัะธะผะตั, ัะปะฐะณ LOCAL_PROCESS ะณะพะฒะพัะธั ัะตะฟะธัะตัั:
ย* "ะะต ะพัะฟัะฐะฒะปัะน ััะพั ะฟะฐะบะตั ะบะพะพัะดะธะฝะฐัะพัั, ะพะฑัะฐะฑะพัะฐะน ัะฐะผ"
ย*/
typedef enum {
ยยยยFLAG_REQUIRE_ACK ย ย = (1 << 0),ย // โ ะขัะตะฑัะตั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟะพะปััะตะฝะธั
ยยยยFLAG_LOCAL_PROCESS ย = (1 << 1),ย // ๐ ะะฑัะฐะฑะพัะฐัั ะปะพะบะฐะปัะฝะพ (ะฝะต ะผะฐัััััะธะทะธัะพะฒะฐัั ะฒะฒะตัั)
ยยยยFLAG_EMERGENCY ย ย ย = (1 << 2),ย // ๐จ ะญะบัััะตะฝะฝัะน ะฟะฐะบะตั (ะพะฑัะฐะฑะพัะฐัั ะฝะตะผะตะดะปะตะฝะฝะพ)
ยยยยFLAG_ENCRYPTED ย ย ย = (1 << 3),ย // ๐ ะะพะปะตะทะฝะฐั ะฝะฐะณััะทะบะฐ ะทะฐัะธััะพะฒะฐะฝะฐ
} PacketFlags;

/**
ย* ๐ฆ ะัะฝะพะฒะฝะฐั ััััะบัััะฐ ะฟะฐะบะตัะฐ
ย*ย
ย* #pragma pack(push, 1) ะพัะบะปััะฐะตั ะฒััะฐะฒะฝะธะฒะฐะฝะธะต ะฒ ะฟะฐะผััะธ.
ย* ะะตะท ััะพะณะพ ะผะตะถะดั ะฟะพะปัะผะธ ะผะพะณะปะธ ะฑั ะฟะพัะฒะธัััั "ะดััั" ะธ ัะฐะทะผะตั
ย* ััััะบัััั ะฝะต ัะพะฒะฟะฐะดะฐะป ะฑั ั ัะตะฐะปัะฝัะผ ัะฐะทะผะตัะพะผ ะฟะฐะบะตัะฐ.
ย*/
#pragma pack(push, 1)

typedef struct {
ยยยย// ๐ ะะดะตะฝัะธัะธะบะฐัะธั
ยยยยuint16_t network_id;ย ย ย ย ย // ะะดะตะฝัะธัะธะบะฐัะพั ัะตัะธ (0xFA23)
ยยยยuint8_tย version; ย ย ย ย ย ย // ะะตััะธั ะฟัะพัะพะบะพะปะฐ (0x01)
ยยยยuint8_tย ttl; ย ย ย ย ย ย ย ย // Time-To-Live (ัะบะพะปัะบะพ ะฟััะถะบะพะฒ ะพััะฐะปะพัั)
ยยยยuint32_t packet_id; ย ย ย ย ย // ะฃะฝะธะบะฐะปัะฝัะน ID ะฟะฐะบะตัะฐ (ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั)
ยยยย
ยยยย// ๐ ะะดัะตัะฐัะธั
ยยยยuint8_tย src_mac[6];ย ย ย ย ย // MAC ะพัะฟัะฐะฒะธัะตะปั (ะบัะพ ัะพะทะดะฐะป ะฟะฐะบะตั)
ยยยยuint8_tย dst_mac[6];ย ย ย ย ย // MAC ะฟะพะปััะฐัะตะปั (ะบะพะผั ะฟัะตะดะฝะฐะทะฝะฐัะฐะตััั)
ยยยยuint8_tย last_hop_mac[6]; ย ย // MAC ะฟัะตะดัะดััะตะณะพ ัะทะปะฐ (ะบัะพ ะฟะตัะตะดะฐะป)
ยยยย
ยยยย// ๐ ะะตัะฐะดะฐะฝะฝัะต
ยยยยuint8_tย msg_type;ย ย ย ย ย ย // ะขะธะฟ ัะพะพะฑัะตะฝะธั (ัะผ. MessageType)
ยยยยuint8_tย flags; ย ย ย ย ย ย ย // ะคะปะฐะณะธ ะฟะฐะบะตัะฐ (ัะผ. PacketFlags)
ยยยยuint16_t group_id;ย ย ย ย ย ย // ID ะณััะฟะฟั (ะดะปั ะณััะฟะฟะพะฒัั ะบะพะผะฐะฝะด)
ยยยย
ยยยย// ๐จ ะะพะปะตะทะฝะฐั ะฝะฐะณััะทะบะฐ
ยยยยuint8_tย payload[180];ย ย ย ย // ะคะฐะบัะธัะตัะบะธะต ะดะฐะฝะฝัะต (ะทะฐะฒะธัะธั ะพั msg_type)
} MeshPacketHeader;
#pragma pack(pop)ย // ะะพัััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะพะฑััะฝะพะต ะฒััะฐะฒะฝะธะฒะฐะฝะธะต

/**
ย* ๐ก๏ธ ะกัััะบัััะฐ ะดะฐะฝะฝัั ะดะฐััะธะบะฐ
ย*ย
ย* ะัะฟะพะปัะทัะตััั ะฒ payload ะบะพะณะดะฐ msg_type = MSG_DATA_SENSOR
ย*/
typedef struct {
ยยยยuint16_t device_type;ย ย ย ย // ะขะธะฟ ััััะพะนััะฒะฐ (0x0001 = ัะตะผะฟะตัะฐัััะฐ)
ยยยยuint32_t timestamp;ย ย ย ย ย // ะัะตะผั ัะฑะพัะฐ ะดะฐะฝะฝัั (ัะตะบัะฝะดั ั 1970)
ยยยยfloatย ย temperature;ย ย ย ย // ะขะตะผะฟะตัะฐัััะฐ ะฒ ยฐC
ยยยยfloatย ย humidity; ย ย ย ย ย // ะะปะฐะถะฝะพััั ะฒ %
ยยยยuint16_t battery_mv; ย ย ย ย // ะะฐะฟััะถะตะฝะธะต ะฑะฐัะฐัะตะธ ะฒ ะผะธะปะปะธะฒะพะปััะฐั
ยยยยint8_t ย rssi; ย ย ย ย ย ย ย // ะฃัะพะฒะตะฝั ัะธะณะฝะฐะปะฐ ะบ ัะพะดะธัะตะปั
ยยยยuint8_tย accuracy; ย ย ย ย ย // ะขะพัะฝะพััั ะธะทะผะตัะตะฝะธั (0-100%)
} SensorData;

/**
ย* ๐ฎ ะกัััะบัััะฐ ะณััะฟะฟะพะฒะพะน ะบะพะผะฐะฝะดั
ย*ย
ย* ะัะฟะพะปัะทัะตััั ะฒ payload ะบะพะณะดะฐ msg_type = MSG_CMD_GROUP
ย* ะะตะฟะธัะตั ะฟะพะปััะฐะตั ัะฐะบัั ะบะพะผะฐะฝะดั ะธ ัะฐัััะปะฐะตั ะตั ะฒัะตะผ
ย* ััััะพะนััะฒะฐะผ ะฒ ัะบะฐะทะฐะฝะฝะพะน ะณััะฟะฟะต.
ย*/
typedef struct {
ยยยยuint16_t group_id; ย ย ย ย ย // ID ะณััะฟะฟั (ะฝะฐะฟัะธะผะตั: 0x0001 = "ะกะฒะตั ะฒ ะฟัะธัะพะถะตะน")
ยยยยuint8_tย command_code; ย ย ย // ะะพะด ะบะพะผะฐะฝะดั (0x01 = ะะะ, 0x00 = ะะซะะ)
ยยยยuint8_tย parameter_len;ย ย ย // ะะปะธะฝะฐ ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะฟะฐัะฐะผะตััะพะฒ
ยยยยuint8_tย parameters[16]; ย ย // ะะฐัะฐะผะตััั ะบะพะผะฐะฝะดั
} GroupCommand;

/**
ย* ๐จ ะกัััะบัััะฐ ัะบัััะตะฝะฝะพะณะพ ัะพะฑััะธั
ย*ย
ย* ะัะฟะพะปัะทัะตััั ะฒ payload ะบะพะณะดะฐ msg_type = MSG_EVENT_BROADCAST
ย* ะะฐัััะปะฐะตััั ะฒัะตะผ ััััะพะนััะฒะฐะผ ะฝะตะผะตะดะปะตะฝะฝะพ.
ย*/
typedef struct {
ยยยยuint8_tย event_type; ย ย ย ย // ะขะธะฟ ัะพะฑััะธั (0x01 = ะฟัะพัะตัะบะฐ, 0x02 = ะณะฐะท)
ยยยยuint8_tย severity; ย ย ย ย ย // ะกะตัััะทะฝะพััั (1-10, ะณะดะต 10 = ะบะฐัะฐัััะพัะฐ)
ยยยยuint32_t timestamp;ย ย ย ย ย // ะะพะณะดะฐ ะฟัะพะธะทะพัะปะพ
ยยยยuint8_tย location_id;ย ย ย ย // ID ะผะตััะพะฟะพะปะพะถะตะฝะธั (ะบะพะผะฝะฐัะฐ)
ยยยยuint8_tย sensor_mac[6];ย ย ย // MAC ะดะฐััะธะบะฐ ะบะพัะพััะน ะพะฑะฝะฐััะถะธะป
ยยยยchar ย ย description[32];ย ย // ะงะตะปะพะฒะตะบะพัะธัะฐะตะผะพะต ะพะฟะธัะฐะฝะธะต
} EmergencyEvent;

/**
ย* ๐บ๏ธ ะะฐะฟะธัั ะฒ ัะฐะฑะปะธัะต ะผะฐัััััะธะทะฐัะธะธ
ย*ย
ย* ะะฐะถะดะพะต ััััะพะนััะฒะพ ััะฐะฝะธั ัะฐะฑะปะธัั "ะบัะพ ะบัะดะฐ ะฟะพะดะบะปััะตะฝ".
ย* ะญัะพ ะฝัะถะฝะพ ััะพะฑั ะทะฝะฐัั ะบัะดะฐ ะฟะตัะตััะปะฐัั ะฟะฐะบะตัั.
ย*/
typedef struct {
ยยยยuint8_tย device_mac[6];ย ย ย // MAC ััััะพะนััะฒะฐ
ยยยยuint8_tย parent_mac[6];ย ย ย // MAC ะตะณะพ ัะพะดะธัะตะปั
ยยยยuint8_tย level;ย ย ย ย ย ย ย // ะฃัะพะฒะตะฝั ะฒ ะดะตัะตะฒะต (0 = ะบะพะพัะดะธะฝะฐัะพั)
ยยยยint8_t ย rssi; ย ย ย ย ย ย ย // ะกะธะปะฐ ัะธะณะฝะฐะปะฐ ะพั ััััะพะนััะฒะฐ
ยยยยuint32_t last_seen;ย ย ย ย ย // ะะพะณะดะฐ ะฟะพัะปะตะดะฝะธะน ัะฐะท ะฒะธะดะตะปะธ
ยยยยuint16_t battery_mv; ย ย ย ย // ะฃัะพะฒะตะฝั ะฑะฐัะฐัะตะธ (ะตัะปะธ ะตััั)
ยยยยuint8_tย status; ย ย ย ย ย ย // ะกัะฐััั: 0=ะพัะปะฐะนะฝ, 1=ะพะฝะปะฐะนะฝ, 2=ะดะตะณัะฐะดะธัะพะฒะฐะป
} RoutingEntry;

/**
ย* โ ะะฐะปะธะดะฐัะธั ะฟะฐะบะตัะฐ
ย*ย
ย* ะัะพะฒะตััะตั ะฑะฐะทะพะฒัั ะบะพััะตะบัะฝะพััั ะฟะฐะบะตัะฐ:
ย* - ะัะฐะฒะธะปัะฝัะน ัะฐะทะผะตั
ย* - ะะฐั network_id
ย* - ะะพััะตะบัะฝะฐั ะฒะตััะธั ะฟัะพัะพะบะพะปะฐ
ย*ย
ย* @param pkt ะฃะบะฐะทะฐัะตะปั ะฝะฐ ะฟะฐะบะตั
ย* @param len ะคะฐะบัะธัะตัะบะฐั ะดะปะธะฝะฐ ะฟะพะปััะตะฝะฝัั ะดะฐะฝะฝัั
ย* @return true ะตัะปะธ ะฟะฐะบะตั ะฒะฐะปะธะดะตะฝ, false ะตัะปะธ ะฝะตั
ย*/
static inline bool validate_packet(const MeshPacketHeader* pkt, size_t len) {
ยยยย// ะััััะฐั ะฟัะพะฒะตัะบะฐ: ะฟะฐะบะตั ะฝะต ะผะพะถะตั ะฑััั ะผะตะฝััะต ะทะฐะณะพะปะพะฒะบะฐ
ยยยยif (len < sizeof(MeshPacketHeader)) {
ยยยยยยยยreturn false;
ยยยย}
ยยยย
ยยยย// ะญัะพ ะฟะฐะบะตั ะธะท ะฝะฐัะตะน ัะตัะธ?
ยยยยif (pkt->network_id != MESH_NETWORK_ID) {
ยยยยยยยยreturn false;
ยยยย}
ยยยย
ยยยย// ะะพะดะดะตัะถะธะฒะฐะตะผะฐั ะฒะตััะธั ะฟัะพัะพะบะพะปะฐ?
ยยยยif (pkt->version != PROTOCOL_VERSION) {
ยยยยยยยยreturn false;
ยยยย}
ยยยย
ยยยย// TTL ะฝะต ะดะพะปะถะตะฝ ะฑััั ะฝัะปัะผ (ะฟะฐะบะตั ะฑั ัะถะต ัะผะตั)
ยยยยif (pkt->ttl == 0) {
ยยยยยยยยreturn false;
ยยยย}
ยยยย
ยยยยreturn true;
}

/**
ย* โฌ๏ธ ะฃะผะตะฝััะตะฝะธะต TTL
ย*ย
ย* ะะฐะถะดัะน ัะฐะท ะบะพะณะดะฐ ะฟะฐะบะตั ะฟะตัะตััะปะฐะตััั, TTL ัะผะตะฝััะฐะตััั ะฝะฐ 1.
ย* ะะพะณะดะฐ TTL ะดะพััะธะณะฐะตั 0, ะฟะฐะบะตั ะพัะฑัะฐััะฒะฐะตััั.
ย* ะญัะพ ะฟัะตะดะพัะฒัะฐัะฐะตั ะฒะตัะฝัั ัะธัะบัะปััะธั ะฟะฐะบะตัะพะฒ ะฒ ัะตัะธ.
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะพะฑัะฐะฑะพัะบะธ
ย*/
static inline void decrement_ttl(MeshPacketHeader* pkt) {
ยยยยif (pkt->ttl > 0) {
ยยยยยยยยpkt->ttl--;
ยยยย}
}

/**
ย* ๐ ะะฑะฝะพะฒะปะตะฝะธะต ะธะฝัะพัะผะฐัะธะธ ะพ ะฟะพัะปะตะดะฝะตะผ ะฟััะถะบะต
ย*ย
ย* ะะพะณะดะฐ ัะตะฟะธัะตั ะฟะตัะตััะปะฐะตั ะฟะฐะบะตั, ะพะฝ ะทะฐะฟะธััะฒะฐะตั ัะฒะพะน MAC
ย* ะฒ ะฟะพะปะต last_hop_mac. ะญัะพ ะฟะพะผะพะณะฐะตั ะพััะปะตะถะธะฒะฐัั ะฟััั ะฟะฐะบะตัะฐ
ย* ะธ ะธะทะผะตัััั ะบะฐัะตััะฒะพ ัะฒัะทะธ ะผะตะถะดั ัะทะปะฐะผะธ.
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะพะฑะฝะพะฒะปะตะฝะธั
ย* @param my_mac MAC ัะตะบััะตะณะพ ััััะพะนััะฒะฐ
ย*/
static inline void update_last_hop(MeshPacketHeader* pkt, const uint8_t* my_mac) {
ยยยยmemcpy(pkt->last_hop_mac, my_mac, 6);
}

/**
ย* ๐ฏ ะัะพะฒะตัะบะฐ: ะฟะฐะบะตั ะฟัะตะดะฝะฐะทะฝะฐัะตะฝ ะฝะฐะผ?
ย*ย
ย* ะะฐะบะตั ะผะพะถะตั ะฑััั ะฐะดัะตัะพะฒะฐะฝ:
ย* 1. ะะพะฝะบัะตัะฝะพ ะฝะฐะผ (ะฟะพ ะฝะฐัะตะผั MAC)
ย* 2. ะัะตะผ (broadcast)
ย* 3. ะะพะผั-ัะพ ะดััะณะพะผั (ะฝัะถะฝะพ ะฟะตัะตัะปะฐัั)
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะฟัะพะฒะตัะบะธ
ย* @param our_mac ะะฐั MAC ะฐะดัะตั
ย* @return true ะตัะปะธ ะฟะฐะบะตั ะดะปั ะฝะฐั, false ะตัะปะธ ะฝะตั
ย*/
static inline bool is_packet_for_us(const MeshPacketHeader* pkt, const uint8_t* our_mac) {
ยยยย// ะจะธัะพะบะพะฒะตัะฐัะตะปัะฝัะน ะฟะฐะบะตั? (FF:FF:FF:FF:FF:FF)
ยยยยif (memcmp(pkt->dst_mac, BROADCAST_MAC, 6) == 0) {
ยยยยยยยยreturn true;
ยยยย}
ยยยย
ยยยย// ะะฐะบะตั ะบะพะฝะบัะตัะฝะพ ะฝะฐะผ?
ยยยยif (memcmp(pkt->dst_mac, our_mac, 6) == 0) {
ยยยยยยยยreturn true;
ยยยย}
ยยยย
ยยยย// ะะฐะบะตั ะฝะต ะดะปั ะฝะฐั
ยยยยreturn false;
}

/**
ย* ๐ ะัะพะฒะตัะบะฐ ัะปะฐะณะฐ ะปะพะบะฐะปัะฝะพะน ะพะฑัะฐะฑะพัะบะธ
ย*ย
ย* ะัะปะธ ัััะฐะฝะพะฒะปะตะฝ ัะปะฐะณ LOCAL_PROCESS, ัะตะฟะธัะตั ะดะพะปะถะตะฝ
ย* ะพะฑัะฐะฑะพัะฐัั ะฟะฐะบะตั ัะฐะผ, ะฝะต ะพัะฟัะฐะฒะปัั ะตะณะพ ะบะพะพัะดะธะฝะฐัะพัั.
ย* ะัะฟะพะปัะทัะตััั ะดะปั ะฑัััััั ะปะพะบะฐะปัะฝัั ะบะพะผะฐะฝะด.
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะฟัะพะฒะตัะบะธ
ย* @return true ะตัะปะธ ะฝัะถะฝะฐ ะปะพะบะฐะปัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ
ย*/
static inline bool requires_local_processing(const MeshPacketHeader* pkt) {
ยยยยreturn (pkt->flags & FLAG_LOCAL_PROCESS) != 0;
}

/**
ย* ๐จ ะัะพะฒะตัะบะฐ: ัะบัััะตะฝะฝัะน ะฟะฐะบะตั?
ย*ย
ย* ะญะบัััะตะฝะฝัะต ะฟะฐะบะตัั ะพะฑัะฐะฑะฐััะฒะฐัััั ะฝะตะผะตะดะปะตะฝะฝะพ,
ย* ะฒะฝะต ะพัะตัะตะดะธ. ะะฐะฟัะธะผะตั: ะฟะพะถะฐั, ะฟัะพัะตัะบะฐ.
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะฟัะพะฒะตัะบะธ
ย* @return true ะตัะปะธ ััะพ ัะบัััะตะฝะฝัะน ะฟะฐะบะตั
ย*/
static inline bool is_emergency_packet(const MeshPacketHeader* pkt) {
ยยยยreturn (pkt->flags & FLAG_EMERGENCY) != 0;
}

/**
ย* ๐ ะัะพะฒะตัะบะฐ: ะฟะฐะบะตั ะทะฐัะธััะพะฒะฐะฝ?
ย*ย
ย* ะัะปะธ ัััะฐะฝะพะฒะปะตะฝ ัะปะฐะณ ENCRYPTED, payload ะทะฐัะธััะพะฒะฐะฝ
ย* ะธ ะตะณะพ ะฝัะถะฝะพ ัะฐััะธััะพะฒะฐัั ะฟะตัะตะด ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ.
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะฟัะพะฒะตัะบะธ
ย* @return true ะตัะปะธ ะฟะฐะบะตั ะทะฐัะธััะพะฒะฐะฝ
ย*/
static inline bool is_encrypted_packet(const MeshPacketHeader* pkt) {
ยยยยreturn (pkt->flags & FLAG_ENCRYPTED) != 0;
}

/**
ย* โ ะัะพะฒะตัะบะฐ: ััะตะฑัะตััั ะฟะพะดัะฒะตัะถะดะตะฝะธะต?
ย*ย
ย* ะัะปะธ ัััะฐะฝะพะฒะปะตะฝ ัะปะฐะณ REQUIRE_ACK, ะพัะฟัะฐะฒะธัะตะปั ะถะดัั
ย* ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟะพะปััะตะฝะธั. ะัะปะธ ะฝะต ะฟะพะปััะธั โ ะพัะฟัะฐะฒะธั ะฟะพะฒัะพัะฝะพ.
ย*ย
ย* @param pkt ะะฐะบะตั ะดะปั ะฟัะพะฒะตัะบะธ
ย* @return true ะตัะปะธ ะฝัะถะฝะพ ะพัะฟัะฐะฒะธัั ะฟะพะดัะฒะตัะถะดะตะฝะธะต
ย*/
static inline bool requires_acknowledgment(const MeshPacketHeader* pkt) {
ยยยยreturn (pkt->flags & FLAG_REQUIRE_ACK) != 0;
}

// ะะพะฝะตั ัะฐะนะปะฐ
